{% extends "dashboard/base_admin.html" %}
{% load humanize %}
{% load static %}
{% block title %}Admin Dashboard - Overview{% endblock %}

{% block content %}
<link rel="stylesheet" href="{% static 'css/admin_dashboard.css' %}">
<!-- Page Header -->
<div class="page-header">
  <div>
    <h1 class="page-title">
      <i class="fas fa-tachometer-alt me-2"></i>
      Dashboard Overview
    </h1>
    <p class="page-subtitle">{{ message }}</p>
  </div>
</div>

<!-- KPI Cards -->
<div class="admin-grid grid-3">
  <!-- Server Status Card -->
  <div class="admin-card">
    <div class="card-header">
      <h3 class="card-title">
        <i class="fas fa-server me-2 text-primary"></i>
        Server Status
      </h3>
    </div>
    <div class="text-center">
      <div class="status-indicator status-success mb-3" id="server-status-indicator">
        <i class="fas fa-check-circle"></i>
        Online
      </div>
      <div class="row text-center">
        <div class="col-6">
          <h4 class="fw-bold text-primary" id="server-uptime">--</h4>
          <small class="text-muted">Uptime</small>
        </div>
        <div class="col-6">
          <h4 class="fw-bold text-success" id="server-response-time">--</h4>
          <small class="text-muted">Response</small>
        </div>
      </div>
    </div>
  </div>

  <!-- User Approval Card -->
  <div class="admin-card">
    <div class="card-header">
      <h3 class="card-title">
        <i class="fas fa-user-check me-2 text-warning"></i>
        Pending Users
      </h3>
    </div>
    <div class="text-center">
      <h2 class="fw-bold text-warning mb-2">{{ pending_users_count }}</h2>
      <p class="text-muted mb-3">Users awaiting approval</p>
      {% if pending_users_count > 0 %}
        <a href="{% url 'admin_user_management' username=username %}?status=pending" class="btn-admin btn-warning">
          <i class="fas fa-eye"></i>
          Review
        </a>
      {% else %}
        <span class="text-muted">All users processed</span>
      {% endif %}
    </div>
  </div>


  <!-- System Health Card -->
  <div class="admin-card">
    <div class="card-header">
      <h3 class="card-title">
        <i class="fas fa-heartbeat me-2 text-danger"></i>
        System Health
      </h3>
    </div>
    <div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">CPU Usage</span>
        <span class="fw-bold" id="cpu-usage-percent">--</span>
      </div>
      <div class="progress mb-3" style="height: 6px;">
        <div class="progress-bar bg-primary" id="cpu-progress-bar" style="width: 0%"></div>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">Memory</span>
        <span class="fw-bold" id="memory-usage-percent">--</span>
      </div>
      <div class="progress mb-3" style="height: 6px;">
        <div class="progress-bar bg-warning" id="memory-progress-bar" style="width: 0%"></div>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <span class="text-muted">Storage</span>
        <span class="fw-bold" id="storage-usage-percent">--</span>
      </div>
      <div class="progress" style="height: 6px;">
        <div class="progress-bar bg-danger" id="storage-progress-bar" style="width: 0%"></div>
      </div>
    </div>
  </div>
</div>

<!-- Charts Section -->
<div class="admin-grid grid-2">
  <!-- Server Performance Chart -->
  <div class="admin-card">
    <div class="card-header">
      <h3 class="card-title">
        <i class="fas fa-chart-line me-2"></i>
        Server Performance (24h)
      </h3>
    </div>
    <div style="height: 300px; display: flex; align-items: center; justify-content: center; background: rgba(52, 73, 94, 0.05); border-radius: 12px;">
      <canvas id="performanceChart"></canvas>
    </div>
  </div>

  <!-- User Activity Chart -->
  <div class="admin-card">
    <div class="card-header">
      <h3 class="card-title">
        <i class="fas fa-users me-2"></i>
        User Activity
      </h3>
    </div>
    <div style="height: 300px; display: flex; align-items: center; justify-content: center; background: rgba(52, 73, 94, 0.05); border-radius: 12px;">
      <canvas id="activityChart"></canvas>
    </div>
  </div>
</div>

<!-- Recent Activity & Quick Actions -->
<div class="admin-grid grid-2">
  <!-- Recent Activity -->
  <div class="admin-card">
    <div class="card-header">
      <h3 class="card-title">
        <i class="fas fa-history me-2"></i>
        Recent Activity
      </h3>
    </div>
    <div class="activity-feed">
      <div class="activity-item d-flex align-items-center mb-3">
        <div class="activity-icon bg-success text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
          <i class="fas fa-user-plus"></i>
        </div>
        <div class="flex-grow-1">
          <p class="mb-1"><strong>New registrations this week:</strong> {{ recent_registrations }}</p>
          <small class="text-muted">{{ recent_registrations }} new user{{ recent_registrations|pluralize }} registered</small>
        </div>
      </div>
      <div class="activity-item d-flex align-items-center mb-3">
        <div class="activity-icon bg-info text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
          <i class="fas fa-users"></i>
        </div>
        <div class="flex-grow-1">
          <p class="mb-1"><strong>Total active users:</strong> {{ active_users_count }}</p>
          <small class="text-muted">{{ active_users_count }} user{{ active_users_count|pluralize }} currently active</small>
        </div>
      </div>
      <div class="activity-item d-flex align-items-center mb-3">
        <div class="activity-icon bg-warning text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
          <i class="fas fa-clock"></i>
        </div>
        <div class="flex-grow-1">
          <p class="mb-1"><strong>Pending approvals:</strong> {{ pending_users_count }}</p>
          <small class="text-muted">{{ pending_users_count }} user{{ pending_users_count|pluralize }} awaiting approval</small>
        </div>
      </div>
      <div class="activity-item d-flex align-items-center">
        <div class="activity-icon bg-primary text-white rounded-circle d-flex align-items-center justify-content-center me-3" style="width: 40px; height: 40px;">
          <i class="fas fa-shield-alt"></i>
        </div>
        <div class="flex-grow-1">
          <p class="mb-1"><strong>Admin users:</strong> {{ admin_users_count }}</p>
          <small class="text-muted">{{ admin_users_count }} administrator{{ admin_users_count|pluralize }} in system</small>
        </div>
      </div>
    </div>
  </div>

  <!-- Quick Actions -->
  <div class="admin-card">
    <div class="card-header">
      <h3 class="card-title">
        <i class="fas fa-bolt me-2"></i>
        Quick Actions
      </h3>
    </div>
    <div class="quick-actions">
      <div class="row g-3">
        <div class="col-6">
          <a href="{% url 'admin_user_management' username=username %}?status=pending" class="btn-admin btn-primary w-100 text-center py-3 text-decoration-none">
            <i class="fas fa-users d-block mb-2" style="font-size: 1.5rem;"></i>
            <span>Manage Users</span>
          </a>
        </div>
        <div class="col-6">
          <button class="btn-admin btn-success w-100 text-center py-3" onclick="backupData()">
            <i class="fas fa-download d-block mb-2" style="font-size: 1.5rem;"></i>
            <span>Backup Data</span>
          </button>
        </div>
        <div class="col-6">
          <button class="btn-admin btn-warning w-100 text-center py-3" onclick="openSettings()">
            <i class="fas fa-cogs d-block mb-2" style="font-size: 1.5rem;"></i>
            <span>Settings</span>
          </button>
        </div>
        <div class="col-6">
          <a href="{% url 'admin_server_monitor' username=username %}" class="btn-admin btn-danger w-100 text-center py-3 text-decoration-none">
            <i class="fas fa-server d-block mb-2" style="font-size: 1.5rem;"></i>
            <span>Server Monitor</span>
          </a>
        </div>
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
// Set global variables for JavaScript
window.dashboardConfig = {
    username: '{{ username }}',
    dashboardStatsUrl: '{% url "admin_dashboard_stats" username=username %}',
    serverMetricsUrl: '{% url "server_metrics_api" %}',
    userCounts: {
        regular: {{ regular_users_count|default:0 }},
        pending: {{ pending_users_count|default:0 }},
        admin: {{ admin_users_count|default:0 }}
    }
};
</script>
<script src="{% static 'js/admin_dashboard.js' %}"></script>
{% endblock %}
