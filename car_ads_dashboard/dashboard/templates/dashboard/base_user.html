{% load static %}
{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5, user-scalable=yes" />
  <title>{% block title %}ScrapResultDash{% endblock %}</title>
  <!-- Mobile Optimization Meta Tags -->
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="default">
  <meta name="theme-color" content="#30475E">
  <meta name="msapplication-navbutton-color" content="#30475E">
  <meta name="apple-mobile-web-app-title" content="ScrapResultDash">
  <meta name="application-name" content="ScrapResultDash">
  
  <!-- Performance Hints -->
  <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
  <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
  <link rel="preload" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" as="style">
  <link rel="preload" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" as="style">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <!-- Modular CSS Architecture -->
  <link rel="stylesheet" href="{% static 'css/base_user.css' %}">
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light fixed-top shadow-sm">
    <div class="container-fluid">
      <!-- Brand -->
      <a href="{% url 'user_dashboard' username %}" class="app-brand">
        <i class="fas fa-chart-line"></i>
        <span class="brand-full">ScrapResultDash</span>
        <span class="brand-short">SRD</span>
      </a>
      <!-- Toggler -->
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarContent"
        aria-controls="navbarContent"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <!-- Collapsible content -->
      <div class="collapse navbar-collapse" id="navbarContent">
        <!-- Left menu -->
        <ul class="navbar-nav me-auto mb-2 mb-lg-0">
        <li class="nav-item dropdown">
          <a 
            class="nav-link dropdown-toggle" 
            href="#" 
            role="button" 
            data-bs-toggle="dropdown" 
            aria-expanded="false"
          >
            Home
          </a>
          <ul class="dropdown-menu compact-dropdown">
            <li>
              <a class="dropdown-item d-flex align-items-center justify-content-center" href="{% url 'user_dashboard' username %}?source=mudahmy">
                <span class="source-badge source-mudah">M</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item d-flex align-items-center justify-content-center" href="{% url 'user_dashboard' username %}?source=carlistmy">
                <span class="source-badge source-carlist">C</span>
              </a>
            </li>
          </ul>
        </li>
        <li class="nav-item dropdown">
          <a 
            class="nav-link dropdown-toggle" 
            href="#" 
            role="button" 
            data-bs-toggle="dropdown" 
            aria-expanded="false"
          >
            Data Listing
          </a>
          <ul class="dropdown-menu compact-dropdown">
            <li>
              <a class="dropdown-item d-flex align-items-center justify-content-center" href="{% url 'user_dataListing' username %}?source=mudahmy">
                <span class="source-badge source-mudah">M</span>
              </a>
            </li>
            <li>
              <a class="dropdown-item d-flex align-items-center justify-content-center" href="{% url 'user_dataListing' username %}?source=carlistmy">
                <span class="source-badge source-carlist">C</span>
              </a>
            </li>
          </ul>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="#">Distribution Location</a>
        </li>
      </ul>
        <!-- Right menu -->
        <ul class="navbar-nav ms-auto align-items-center">
          <li class="nav-item d-flex align-items-center">
            <!-- Dark mode toggle button -->
            <button id="darkModeToggle" class="btn btn-link p-0 me-2" style="font-size: 1.5rem;" title="Toggle dark mode">
              <span id="darkModeIcon">
                <!-- Matahari (default light mode) -->
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" width="24" height="24"><path d="M12 18C8.68629 18 6 15.3137 6 12C6 8.68629 8.68629 6 12 6C15.3137 6 18 8.68629 18 12C18 15.3137 15.3137 18 12 18ZM12 16C14.2091 16 16 14.2091 16 12C16 9.79086 14.2091 8 12 8C9.79086 8 8 9.79086 8 12C8 14.2091 9.79086 16 12 16ZM11 1H13V4H11V1ZM11 20H13V23H11V20ZM3.51472 4.92893L4.92893 3.51472L7.05025 5.63604L5.63604 7.05025L3.51472 4.92893ZM16.9497 18.364L18.364 16.9497L20.4853 19.0711L19.0711 20.4853L16.9497 18.364ZM19.0711 3.51472L20.4853 4.92893L18.364 7.05025L16.9497 5.63604L19.0711 3.51472ZM5.63604 16.9497L7.05025 18.364L4.92893 20.4853L3.51472 19.0711L5.63604 16.9497ZM23 11V13H20V11H23ZM4 11V13H1V11H4Z"></path></svg>
              </span>
            </button>
            <!-- User icon dropdown -->
            <div class="nav-item dropdown user-dropdown">
              <a class="nav-link dropdown-toggle p-0" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                <span class="user-icon">
                  {{ username|slice:":1"|upper }}
                </span>
              </a>
              <ul class="dropdown-menu dropdown-menu-end shadow" aria-labelledby="userDropdown" style="min-width: 220px;">
                <li class="px-3 py-2">
                  <div class="fw-bold">Halo, {{ username|capfirst }}</div>
                  <div class="text-muted small">{{ user.email }}</div>
                </li>
                <li><hr class="dropdown-divider"></li>
                <li>
                  <a class="dropdown-item d-flex align-items-center" href="{% url 'user_profile' username %}">
                    <i class="fas fa-user-cog me-2"></i>
                    Profile Settings
                  </a>
                </li>
                <li>
                  <form method="post" action="{% url 'logout' %}" style="display:inline;">
                    {% csrf_token %}
                    <button type="submit" class="dropdown-item d-flex align-items-center">
                      <i class="fas fa-sign-out-alt me-2"></i>
                      Logout
                    </button>
                  </form>
                </li>
              </ul>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="main-content">
    {% block content %}
    {% endblock %}
  </main>

  <!-- Bootstrap JS Bundle CDN -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

  <!-- Core JavaScript Architecture -->
  <script src="{% static 'js/core/mobile.js' %}"></script>
  <script src="{% static 'js/core/darkmode.js' %}"></script>

  <!-- Utility Libraries -->
  <script src="{% static 'js/utils/device-helpers.js' %}"></script>
  <script src="{% static 'js/utils/form-helpers.js' %}"></script>

  <!-- Component Libraries -->
  <script src="{% static 'js/components/profile-forms.js' %}"></script>
  <script src="{% static 'js/components/data-listing.js' %}"></script>

  <!-- Page-specific JavaScript -->
  <script src="{% static 'js/pages/dashboard.js' %}"></script>

  <!-- Main Application Manager -->
  <script src="{% static 'js/main.js' %}"></script>

  <script>
    // Pass Django variables to JavaScript
    window.baseUserConfig = {
      username: '{{ username|default:"" }}',
      userEmail: '{{ user.email|default:"" }}'
    };

    // Override global config with page-specific settings
    window.AppConfig.api.baseUrl = '/dashboard';
    window.AppConfig.user = window.baseUserConfig;
  </script>

  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
  <script src="{% static 'js/base_user.js' %}"></script>
</body>
</html>