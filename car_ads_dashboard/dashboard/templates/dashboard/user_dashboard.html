{% extends "dashboard/base_user.html" %}

{% block title %}User Dashboard{% endblock %}

{% block content %}
{% load humanize %}
<h5 class="text-center mb-4">Dashboard - {{ source|capfirst }}</h5>
<div class="container-fluid p-0">
  <div class="row g-4 align-items-stretch">
    <!-- Card Brand Lebar -->
    <div class="col-lg-6">
      <div class="card flex-fill" style="border-radius:5px; min-height:400px; overflow:auto;">
        <div class="card-body d-flex flex-column align-items-center justify-content-start p-3">
          <strong class="mb-2" style="font-size:1.2rem;">Make</strong>
          <ul class="mb-0 w-100" style="font-size:1rem; list-style:none; padding-left:0; max-height:350px; overflow:auto;">
            {% for brand, total in top_ads %}
              <li class="d-flex justify-content-between border-bottom py-1">
                <span>{{ brand|default:"Unknown" }}</span>
                <span class="text-secondary">({{ total|intcomma }})</span>
              </li>
            {% endfor %}
          </ul>
        </div>
      </div>
    </div>
    <!-- Card Chart Kanan -->
    <div class="col-lg-6">
      <div class="card h-100" style="border-radius:20px;">
        <div class="card-body d-flex flex-column justify-content-center align-items-center" style="height:100%;">
          <canvas id="barChart"></canvas>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Chart.js CDN -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  const ctx = document.getElementById('barChart').getContext('2d');
  const barChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: {{ chart_labels|safe }},
      datasets: [{
        label: 'Jumlah Iklan',
        data: {{ chart_data|safe }},
        backgroundColor: 'rgba(54, 162, 235, 0.7)',
        borderRadius: 10,
        borderSkipped: false,
      }]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: { display: false },
        title: { display: true, text: '10 Brand dengan Iklan Terbanyak' }
      },
      scales: {
        y: { beginAtZero: true }
      }
    }
  });
</script>
{% endblock %}