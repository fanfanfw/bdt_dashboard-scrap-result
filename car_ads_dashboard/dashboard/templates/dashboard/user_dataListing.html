{% extends "dashboard/base_user.html" %}
{% load humanize %}
{% block title %}Data Listing{% endblock %}
{% load static %}
{% block content %}
<link rel="stylesheet" href="{% static 'css/user_dataListing.css' %}">
<div class="container-main">
  <!-- Row 1: Title -->
  <div class="title-row">
    <h1>
      <i class="fas fa-database"></i>
      Data Listing {{ source|title }} 
      <span class="badge">{{ total_data|intcomma }}</span>
    </h1>
    <p class="subtitle">Explore and analyze car listing data with advanced filtering options</p>
  </div>

  <!-- Row 2: Filter -->
  <div class="filter-row">
    <form id="filterForm" class="row g-3">
      <div class="col-md-3 col-sm-6">
        <label class="form-label">Brand <span class="text-danger">*</span></label>
        <select class="form-select" name="brand" id="brandSelect" required>
          <option value="">Pilih Brand</option>
          {% for brand in brands %}
            <option value="{{ brand }}">{{ brand }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="col-md-3 col-sm-6">
        <label class="form-label">Model</label>
        <select class="form-select" name="model" id="modelSelect" disabled>
          <option value="">Pilih Model</option>
        </select>
      </div>
      <div class="col-md-3 col-sm-6">
        <label class="form-label">Variant</label>
        <select class="form-select" name="variant" id="variantSelect" disabled>
          <option value="">Pilih Variant</option>
        </select>
      </div>
      <div class="col-md-3 col-sm-6">
        <label class="form-label">Tahun</label>
        <select class="form-select" name="year" id="yearSelect" disabled>
          <option value="">Pilih Tahun</option>
        </select>
      </div>
      <div class="col-12">
        <button type="submit" class="btn btn-primary" id="btnSubmitFilter">Cari</button>
        <button type="reset" class="btn btn-secondary" id="btnResetFilter">Reset</button>
      </div>
    </form>
  </div>

  <!-- Row 3: Sidebar + Toggle + Content -->
  <div class="main-content-row">
    <div class="sidebar-toggle-wrapper">
      <div id="sidebarWrapper" class="sidebar-wrapper">
        <div class="card-toggle-view card mb-3">
          <div class="btn-group w-100" role="group" aria-label="Toggle List/Grid View">
            <button type="button" class="btn btn-outline-primary active" id="btnListView">
              <i class="fas fa-list"></i> List View
            </button>
            <button type="button" class="btn btn-outline-primary" id="btnGridView">
              <i class="fas fa-th-large"></i> Grid View
            </button>
          </div>
        </div>

        <div class="card-brand-stats card flex-grow-1">
          <div id="brandsList"></div>
        </div>
      </div>

      <div class="btn-toggle-sidebar" id="btnToggleSidebar" title="Toggle Sidebar">
        <i class="fas fa-chevron-left"></i>
      </div>
    </div>

    <div id="contentWrapper" class="content-wrapper">
      <div class="table-responsive">
        <table id="listingTable" class="table table-striped table-bordered align-middle w-100">
          <thead>
            <tr>
              <th>Img</th>
              <th>Year</th>
              <th>Brand</th>
              <th>Model</th>
              <th>Variant</th>
              <th>Mileage (km)</th>
              <th>Starting (RM)</th>
              <th>Latest (RM)</th>
              <th>Iklan Tayang</th>
              <th>Status</th>
              <th>Terjual Dalam</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </div>
    <div id="gridViewContainer" class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4" style="display:none; padding: 1rem;">
      <!-- Card grid akan diisi dinamis lewat JS -->
    </div>
  </div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.datatables.net/1.13.4/js/jquery.dataTables.min.js"></script>
<script>
// Pass Django variables to JavaScript
window.dataListingConfig = {
  source: '{{ source }}',
  username: '{{ username }}',
  getListingDataUrl: '{% url "get_listing_data" username %}',
  getBrandStatsUrl: '{% url "get_brand_stats" %}',
  getModelStatsUrl: '{% url "get_model_stats" %}',
  getModelsUrl: '{% url "get_models" %}',
  getVariantsUrl: '{% url "get_variants" %}',
  getYearsUrl: '{% url "get_years" %}'
};
</script>
<script src="{% static 'js/user_dataListing.js' %}"></script>
{% endblock content %}